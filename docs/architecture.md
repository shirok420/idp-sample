# IDP-Sample アーキテクチャ

このドキュメントでは、IDP-Sampleプロジェクトのアーキテクチャについて説明します。

## 全体アーキテクチャ

IDP-Sampleは、以下の3つの主要なOSSコンポーネントを統合して、ゼロトラストアーキテクチャを実現します：

1. **Keycloak**: 認証・認可基盤
2. **MidPoint**: IDM（Identity Management）
3. **Kong**: APIゲートウェイ

これらのコンポーネントは、共通のPostgreSQLデータベースを使用して連携します。

```
                    +----------------+
                    |                |
                    |  クライアント   |
                    |                |
                    +--------+-------+
                             |
                             v
                    +----------------+
                    |                |
                    |   Kong API     |
                    |   Gateway      |
                    |                |
                    +--------+-------+
                             |
           +----------------+----------------+
           |                                 |
           v                                 v
+----------+-----------+         +-----------+----------+
|                      |         |                      |
|      Keycloak        |         |      MidPoint        |
|   (認証・認可基盤)    |         |        (IDM)         |
|                      |         |                      |
+----------+-----------+         +-----------+----------+
           |                                 |
           |                                 |
           v                                 v
+----------+----------------------------------+----------+
|                                                        |
|                     PostgreSQL                         |
|                                                        |
+--------------------------------------------------------+
```

## コンポーネント詳細

### Keycloak (認証・認可基盤)

Keycloakは、モダンなアプリケーションとサービスのためのオープンソースのIdentity and Access Management（IAM）ソリューションです。以下の機能を提供します：

- シングルサインオン（SSO）
- ID管理とアクセス管理
- ソーシャルログイン
- 多要素認証（MFA）
- ユーザー連携
- クライアントアダプター

### MidPoint (IDM)

MidPointは、包括的なオープンソースのIdentity Management（IDM）ソリューションです。以下の機能を提供します：

- ユーザープロビジョニング
- ロール管理
- ID同期
- ワークフロー
- レポーティング
- 監査

### Kong (APIゲートウェイ)

Kongは、マイクロサービス、API、サービスメッシュのためのクラウドネイティブなAPIゲートウェイです。以下の機能を提供します：

- ルーティング
- 認証
- レート制限
- ログ記録
- モニタリング
- トランスフォーメーション

## ゼロトラストアーキテクチャの実現

このアーキテクチャは、以下の方法でゼロトラストセキュリティモデルを実現します：

1. **すべてのアクセスを認証・認可**: KongとKeycloakの統合により、すべてのAPIリクエストが適切に認証・認可されます。

2. **最小権限の原則**: MidPointによるIDMとKeycloakによるロールベースのアクセス制御（RBAC）を組み合わせて、ユーザーに必要最小限の権限のみを付与します。

3. **継続的な検証**: すべてのリクエストは、Kongゲートウェイを通過する際に継続的に検証されます。

4. **セグメンテーション**: サービスごとに適切なセグメンテーションを行い、横方向の移動を制限します。

5. **監視とログ記録**: すべてのコンポーネントで包括的な監視とログ記録を実施し、異常を検出します。

## 高可用性設計

本番環境では、以下の方法で高可用性を実現します：

1. **複数レプリカ**: 各コンポーネントを複数のレプリカで実行し、単一障害点を排除します。

2. **ロードバランシング**: トラフィックを複数のインスタンスに分散させます。

3. **自動スケーリング**: 負荷に応じて自動的にスケールアップ/ダウンします。

4. **ヘルスチェック**: 定期的なヘルスチェックにより、障害のあるインスタンスを検出して交換します。

5. **バックアップと復元**: 定期的なバックアップと迅速な復元手順を確立します。

## 開発環境と本番環境

- **開発環境**: Docker Composeを使用して、単一ホスト上ですべてのコンポーネントを実行します。
- **本番環境**: Kubernetesを使用して、スケーラブルで高可用性のあるデプロイメントを実現します。